description:
    name: abmarl_maze_icm_search
    description: Abmarl maze study

batch:
    type: slurm
    host: pascal
    bank: aiwargm
    queue: pbatch

env:
    variables:
        OUTPUT_PATH: /p/lustre1/maguire7/bs-clip-abmarl-maze
        ENV_PATH: source /usr/workspace/maguire7/virtual_env/bsclip//bin/activate
        RUNNER: /usr/workspace/wsb/maguire7/decsup/ppo_and_friends/baselines/abmarl/abmarl_large_grid_pos_maze.py

generator.parameters:
    SEED:
      values: [0]
      label: SEED.%%
    INV_FWD_SIZE:
      values: [64, 128]
      label: INV_FWD_SIZE.%%
    OBS_DIM:
      values: [3]
      label: OBS_DIM.%%
    ICM_LR:
      values: [0.0001, 0.001]
      label: ICM_LR.%%
    INTR_WEIGHT:
      values: [1.0]
      label: INTR_WEIGHT.%%
    LR:
      values: [0.001, 0.0005, 0.0001]
      label: LR.%%
    ACTOR_HIDDEN:
      values: [64, 128]
      label: ACTOR_HIDDEN.%%
    CRITIC_MULT:
      values: [1, 2]
      label: CRITIC_MULT.%%
    TS_PER_EP:
      values: [64]
      label: TS_PER_EP.%%

study:
    - name: AbmarlMaze
      description: Run an experiment with PPO-AF
      run:
          cmd: |
            source $(ENV_PATH)

            $(LAUNCHER) ppoaf train $(RUNNER) \
                --num_timesteps 20_000_000 \
                --enable_icm 1 \
                --random_seed $(SEED) \
                --icm_inverse_size $(INV_FWD_SIZE) \
                --icm_forward_size $(INV_FWD_SIZE) \
                --icm_encoded_obs_dim $(OBS_DIM) \
                --icm_learning_rate $(ICM_LR) \
                --intr_reward_weight $(INTR_WEIGHT) \
                --learning_rate $(LR) \
                --actor_hidden $(ACTOR_HIDDEN) \
                --critic_hidden_mult $(CRITIC_MULT) \
                --max_ts_per_ep $(TS_PER_EP) \
                --soft_resets 1 \
                --ts_per_rollout 512 \
                --state_tag inv_fwd_size_$(INV_FWD_SIZE)-obs_dim_$(OBS_DIM)-icm_lr_$(ICM_LR)-intr_weight_$(INTR_WEIGHT)-lr_$(LR)-seed_$(SEED)-cm_$(CRITIC_MULT)-ah_$(ACTOR_HIDDEN)

          nodes: 1
          procs: 36
          exclusive: True
          walltime: "24:00:00"
